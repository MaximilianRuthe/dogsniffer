<!DOCTYPE html>
<!--
    Copyright (c) 2012-2014 Adobe Systems Incorporated. All rights reserved.

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
     KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.
-->
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="msapplication-tap-highlight" content="no" />
        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />	
		<link rel='stylesheet' href='css/jquery.mobile-1.4.5.min.css' type='text/css' media='all' />
		<link rel='stylesheet' href='css/druid.css' type='text/css' media='all' />
		<link rel="stylesheet" type="text/css" href="css/index.css" />	
        <title>Dog Sniffer</title>		
		<script type="text/javascript" src="js/jquery.js"></script>
		<script type="text/javascript" src="cordova.js"></script>
		<script type='text/javascript' src='js/jquery.mobile-1.4.5.min.js'></script>		
		<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
		<script type='text/javascript' src='js/gmaps.js'></script>
	<script>
var directions;
var page_title;
$(document).on('pagebeforeshow', "#single", function (event, data) {
    var parameters = $(this).data("url").split("?")[1];;
    DS.post.id = parameter = parameters.replace("id=",""); 
    DS.singleView(DS.post.id);
});
$( document ).on( "pagecreate", "#home", function() {
	DS.onDeviceReady();
    $( "#show-more a" ).on( "click", function( e ){        
        DS.showMore();
        e.preventDefault();
    });	
 	$( "#research" ).on( "click", function( e ){      
		DS.address.zip = '';
		DS.query.search = '';
		DS.query.term = '';  
		$('#opt-zip').val('');
		$('#s').val('');	
		DS.setSelect('#opt-category','all');
        $( "#poo" ).popup( "close" );  
		DS.showMore();
        e.preventDefault();
    });	
	$( "#expand" ).on( "click", function( e ){      
		DS.address.zip = '';
		DS.query.term = '';  
		$('#opt-zip').val('');
		DS.setSelect('#opt-category','all');
        $( "#poo" ).popup( "close" );  
		DS.showMore();
        e.preventDefault();
    });	
	$('.onchange').on( "change", function( e ){  
		DS.refresh_list();
		//DS.address.city = $('#opt-city').val();
		DS.address.zip = $('#opt-zip').val();	
		DS.query.search = $('#s').val();
		if (DS.query.search != '') {
			var fetch = DS.listen('get_search_results',DS.query.search);
			DS.showMore(fetch);
		} else {
			DS.showMore();
		}	  
		e.preventDefault();
    });	
	$('#opt-category').on( "change", function( e ){
		DS.refresh_list();
		DS.query.term = $('#opt-category').val();
		DS.query.term = (DS.query.term == 'all')? '' : DS.query.term;
		DS.showMore();
	});
	$('.submit-login').on( "click", function( e ){
		e.preventDefault();
		DS.login();
	});	
	$('.submit-register').on( "click", function( e ){
		e.preventDefault();
		var required = false;
		$('.reg-field').each(function() {
			var val = $(this).val();
			if(val === ''){	
				$(this).addClass( "error" );
				$('div.register-alert').html('Please Verify the below Fields.').show();		
				return false;
			} else {
				required = true;				
			}
		});
		if (required){
			var password = $('#pass-reg').val();	
			var conf = $('#pass-confirm').val();	
			if(password != conf){
						
			} else {
				DS.register();
			}
		}
		
	});	
});
$( document ).on( "pagecreate", "#single", function() {
	DS.query.search = '';
	var stickyOffset = 40;
	$(document).on('scrollstart', function(){ 
		if ($(window).scrollTop() >= stickyOffset) $('#single-header h1').html(page_title);
		else  $('#single-header h1').html('Dog Sniffer');
	});
	$(document).on('scrollstop', function(){ 
		if ($(window).scrollTop() >= stickyOffset) $('#single-header h1').html(page_title);
		else  $('#single-header h1').html('Dog Sniffer');
	});    
    $( "#map-pop" ).on({
        popupbeforeposition: function() {
            var size = DS.scale( 480, 320, 0, 1 ),
                w = size.width,
                h = size.height;
            $( "#mage-map" ).css( { "width" : w, "height" : h } );
			directions.refresh();
			directions.idle();
			directions.fitZoom();	
        },
        popupafterclose: function() {
            $( "#map-map" ).css( { "width" : 0, "height" : 0 } );
        }
    });
	$('.submit-rating').on( "click", function( e ){	
		e.preventDefault();
		DS.postReview();
	});
});
var DS = {
	address: {full:'',city:'Orange County',city_code: 'oc', zip:'',state:'',street:'',county:''},
	supported: ['Los Angeles','Orange County','Santa Barbara'],
	query: {search: '',term: '',post_type: 'listing',count: 5,offset: 0},
	geo: {origin:[],lat:'',lng:''},
	single: {title:'',about:'',hours:'',website:''},
	user: {cookie:''},
	post: {id:''},
	nearby: false,	
	setSelect: function(target, value){
		$(target).val(value).attr('selected', true).siblings('option').removeAttr('selected');
		$(target).selectmenu();
		$(target).selectmenu("refresh", true);
	},
	setUser: function(){
		$( "#welcome h3" ).html('Welcome Back, '+DS.user.data.displayname);
		$( "#welcome p" ).html('<img src="'+DS.user.data.avatar+'" class="thumbnail" />');
		$( "#welcome" ).popup( "open" );
		$(".login-button").remove();	
		$('.footer-nav').append('<li><a href="#profile" data-icon="user">Profile</a></li>');				
	},
	postReview: function(){
		var review = $('#review_text').val();
		var rating = $('input[name*=rating]:checked').val();
		var url = DS.listen('post_comment',review,rating);
		alert('URL: '+url)
		console.log(url);
		if (url){
			$.ajax({
				type: 'GET',
				url: url,
				dataType: 'json',
            	success: function(response) {
					alert('Success');
					console.log(response);
				}
			});

		} else {
			$( "#login" ).popup( "open" ); 
		}
		
	},
	register: function(){		
		var password = $('#pass-reg').val();	
		var conf = $('#pass-confirm').val();	
		var nonce = DS.listen('get_nonce','user','register');	
		alert('URL: '+nonce);
		DS.pauseInputs('Joining the Pack');
		$.ajax({
			type: 'GET',
			url: nonce,
			dataType: 'json',
            success: function(first) {
				console.log(first);
				if (first.status !== 'ok'){
					$('div.register-alert').html(first.error).show();					
				} else {
					DS.user.username = $('#user-reg').val();
					var password = $('#pass-reg').val();	
					var email = $('#email-reg').val();	
					var register = DS.listen('register',DS.user.username,email, first.nonce, password);
					alert('URL2: '+register)
					$.ajax({
						type: 'GET',
						url: register,
						dataType: 'json',
           				success: function(second) {
							console.log(second);
							if (second.status == 'ok'){		
							}
						},
						timeout: 10000,  // Timeout after 10 seconds
           				error: function(jqXHR, textStatus, errorThrown) {
                			console.log("Error, textStatus: " + textStatus + " errorThrown: "+ errorThrown);
							$.mobile.loading( "hide" );
							DS.onError(errorThrown);
           				}
					});
				}
			},
			timeout: 10000,  // Timeout after 10 seconds
            error: function(jqXHR, textStatus, errorThrown) {
                console.log("Error, textStatus: " + textStatus + " errorThrown: "+ errorThrown);
				$.mobile.loading( "hide" );
				DS.onError(errorThrown);
            }
		}).done(function() {
			DS.playInputs();
		});
		
	},
	login: function(){
	var nonce = DS.listen('get_nonce');
	DS.user.username = $('#user-field').val();
	var password = $('#pass-field').val();	
	DS.pauseInputs('Authenticating');
		$.ajax({
			type: 'GET',
			url: nonce,
			dataType: 'json',
            success: function(first) {
				if (first.status !== 'ok'){
					$('#login div.alert').html(first.error).show();					
				} else {
					var cookie = url+'/api/auth/generate_auth_cookie/?nonce='+first.nonce+'&username='+DS.user.username+'&password='+password+'';
					$.ajax({
						type: 'GET',
						url: cookie,
						dataType: 'json',
           				success: function(second) {
							console.log(second);
							if (second.status == 'ok'){								
								DS.user.cookie = second.cookie;
								DS.user.cookie_name = second.cookie_name;
								DS.user.data = second.user;
								$('#login div.alert').removeClass('alert-red').addClass('alert-success').html('<strong>Success!</strong>');
								$('.user-block').html('<h3>Welcome Back, '+DS.user.data.displayname+'</h3><img src="'+DS.user.data.avatar+'" class="thumbnail" />');
								$('.ui-btn-login').html('Profile');
								
							} else {
								$('#login div.alert').html(second.error).show();
								$('#user-field').val('');
								$('#pass-field').val('');
							}
						},
						timeout: 10000,  // Timeout after 10 seconds
           				error: function(jqXHR, textStatus, errorThrown) {
                			console.log("Error, textStatus: " + textStatus + " errorThrown: "+ errorThrown);
							$.mobile.loading( "hide" );
							DS.onError(errorThrown);
           				}
					});
				}
			},
			timeout: 10000,  // Timeout after 10 seconds
            error: function(jqXHR, textStatus, errorThrown) {
                console.log("Error, textStatus: " + textStatus + " errorThrown: "+ errorThrown);
				$.mobile.loading( "hide" );
				DS.onError(errorThrown);
            }
		}).done(function() {
			DS.playInputs();
		});
	},
	onError: function(text){
		text = text || 'An Error Has Occured';
		$( "#error p" ).html(text);
		$( "#error" ).popup( "open" );  
	},
	refresh_list: function (){
		$('.druid-list-item').remove();
		DS.query.offset = 0;
	},
	listen: function(method,value,value2,value3,value4){
		var url = 'http://dogsniffer.com/'+DS.address.city_code+'/api/';
		method = method || 'get_posts';
		if (method == 'get_posts'){			
			url += method+'/?count='+DS.query.count+'&offset='+DS.query.offset;
			if (DS.address.zip !== '') url += '&meta_key=mage_zip&meta_value='+DS.address.zip;
			if (DS.query.term !== '') url += '&type='+DS.query.term;
			if (DS.query.search !== '') url += '&s='+DS.query.search;
		}
		if (method == 'get_post'){
			url += method+'/?id='+value;
		}
		if (method == 'get_nonce'){
			value = value || 'auth';
			value2 = value2 || 'generate_auth_cookie';
			url += method+'/?controller='+value+'&method='+value2;
			return url;
		}
		if (method == 'register'){
			url += 'user/'+method+'/?username='+value+'&email='+value2+'&nonce='+value3+'&display_name='+value+'&user_pass='+value4+'&notify=no';
			return url;
		}
		if (method == 'get_search_results'){
			url += method+'/?search='+value;
		}
		if (method == 'post_comment'){
			var cookie = DS.user.cookie;
			var id = DS.post.id;
			if (cookie === '' || id === '') return false;
			url += 'user/'+method+'/?cookie='+cookie+'&post_id='+id+'&content='+value+'&comment_status=1&rating='+value2;
			return url;
		}
		if (DS.query.post_type !== ''){
			url += '&post_type='+DS.query.post_type;
		}
		console.log(url);
		return url;	
	},
	singleView: function(singleID){
		var bark = DS.listen('get_post',singleID);
		var mapStatic;
		$.ajax({
		type: 'GET',
		url: bark,
		dataType: 'json',
      	success: function( value ) {		
			console.log(value);	
			value = value.post;
			GMaps.geocode({
			address: value.listing.street+', '+value.listing.city+', '+value.listing.zip,
			callback: function(results, status) {
				if (status == 'OK') {
					var latlng = results[0].geometry.location;
					url = GMaps.staticMapURL({
						size: [800, 180],
						lat: latlng.lat(),
						lng: latlng.lng(),
						markers: [{lat: latlng.lat(),lng: latlng.lng()}]
					});
					//DS.nearby = true;
					//DS.geo.origin = [34.0544902,-118.4413104];
					
					if (DS.nearby){
					directions = new GMaps({
						div: '#mage-map',
						lat: latlng.lat(),
						lng: latlng.lat(),
						disableDefaultUI: true,
						zoom: 12,
						//height: '320px',
						//width: '480px',
						idle: function(){
							directions.refresh();
						},
						resize: function(){
							var center = directions.getCenter();
							directions.setCenter(center.lat(), center.lng());
						}
					});					
					directions.addMarker({
						lat: DS.geo.lat,
						lng: DS.geo.lng
					});
					directions.addMarker({
						lat: latlng.lat(),
						lng: latlng.lng(),
					});
					directions.fitZoom();		
					directions.drawRoute({
						origin: DS.geo.origin,
						destination: [latlng.lat(), latlng.lng()],
                        travelMode: 'driving',
                        strokeColor: '#131540',
                        strokeOpacity: 0.6,
                        strokeWeight: 6
					});					
					var distance = 0;
					var time = 0;
					directions.getRoutes({
						origin: DS.geo.origin,
						destination: [latlng.lat(), latlng.lng()],
						callback: function (e) {
						console.log(e);
						
                            for (var i=0; i<e[0].legs.length; i++) {
								time += e[0].legs[i].duration.value;
								distance += e[0].legs[i].distance.value;
                            }
							time = Math.round(time / 60);
							distance = (Math.ceil( distance * 0.62137 ) / 1000).toFixed(1);
							$(".dist").append('<div class="dist-time">'+time+' min</div>'+distance+' miles');
                        }
					});
					} else {
						$('.page-directions').remove();
					}
					$(".mapbox").css('background-image','url('+url+')');
					$(".map-add").append(value.listing.street+'<br />'+value.listing.city+', '+value.listing.zip);
				}
			}
			});	
			var reviews = DS.displayReview(value.rating);	
			var cat = category = hours = openDay = website = theTime = '';
			if (value.types.children.length !== 0) {
				cat = value.types.children[0].term_id;
				category = '<p class="category">'+value.types.children[0].name+'</p>';
			}				
			if (value.cast !== undefined){
			var today = new Date();
			var weekdays = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
			var weekday = weekdays[today.getDay()];
			$.each({'Monday':'mon','Tuesday':'tue','Wednesday':'wed','Thursday':'thu','Friday':'fri','Saturday':'sat','Sunday':'sun'}, function(day,hour){
				theTime = value.cast['mage_'+hour+'-from'] || '';	
				if (theTime !== ''){ 
					hours += '<strong>'+day+':</strong> '+value.cast['mage_'+hour+'-from']+' - '+value.cast['mage_'+hour+'-to']+'<br />';
					if (weekday === day) openDay = '<div class="today">Hours Today: '+value.cast['mage_'+hour+'-from']+' - '+value.cast['mage_'+hour+'-to']+'</div>';
				} else {
				
				
				}
			});
			var website = value.cast['mage_url'];
			if (hours !== '') $("#listing-more").append('<li data-role="list-divider">Hours</li><li>'+hours+'</li>');
			if (website !== '') $("#listing-more").append('<li data-role="list-divider">Website</li><li><a href="'+website+'">'+website+'</a></li>');
			}
			var sniffed = '<h2>'+value.title+'</h2>'+reviews+openDay+category;			
			$(".entry-header").append(sniffed);	
			$("#listing-about").append('<h2>About</h2><p>'+value.content+'</p>');
			$("#listing-more").append('<li data-role="list-divider">About</li><li>'+value.content+'</li>');
			$( "#listing-more" ).listview( "refresh" );
			$("#tel a").attr("href", 'tel:'+value.listing.phone);
			$("#tel a").append(' '+value.listing.phone);			
			DS.showReviews(value.reviews);  
			if (cat !== '') {
				DS.query.count =3;
				DS.query.term = cat;
				DS.showRelated();     
			}  
            },
            timeout: 6000,  // Timeout after 6 seconds
            error: function(jqXHR, textStatus, errorThrown) {
                console.log("Error, textStatus: " + textStatus + " errorThrown: "+ errorThrown);                
            }
        });
		
	},	
	pauseInputs: function (text){
		$('select').selectmenu('disable');
		$('button, a.ui-btn').attr('disabled','disabled');
		$('a.ui-btn').addClass('ui-disabled');
		$('input[type="text"], input[type="search"]').attr('disabled','disabled');
		text = text || 'Sniffing Out Locations Near You';
		if (DS.address.zip !== '') loadtext = 'Sniffing Out Locations Near '+DS.address.zip;
		$.mobile.loading( "show", {
			text: text,
			textVisible: true,
			theme: 'z',
			html: ""
		});	
	},
	playInputs: function (){
		$('select').selectmenu('enable');
		$('button').removeAttr('disabled','disabled');
		$('a.ui-btn').removeClass('ui-disabled');
		$('input[type="text"], input[type="search"]').removeAttr('disabled','disabled');
		$.mobile.loading( "hide" );
	},
	displayReview: function(rating,single){
		rating = rating || '';
		if (rating === '') return '';
		single = single || false;
		if (single) return '<div class="average-rating"><div class="author-rating"><span style="width:'+rating+'%;"></span></div></div>';
		var count = rating.review_count;
		var reviews = '';
		if (count > 1){
			reviews += ' <div class="review-count">'+count+' reviews</div>';
		} else if (count == 1){
			reviews += '<div class="review-count">'+count+' review</div>';
		}
		return '<div class="average-rating"><div class="author-rating"><span style="width:'+rating.rating+'%;"></span></div>'+reviews+'</div>';
	},
	displayImage: function(thumb){
		thumb = thumb || 'http://dogsniffer.com/wp-content/themes/Gryphon/mage/images/dining.png';
		return '<img src="'+thumb+'" class="thumbnail" />';
	},
    showMore: function(whistle) {
		whistle = whistle || DS.listen();
		DS.pauseInputs();
        $.ajax({
			type: 'GET',
			url: whistle,
			dataType: 'json',
            success: function( response ) {
				var sniffed = '';							
        		$.each(response.posts, function(index, value) {
					DS.query.offset += 1;
					console.log(value);	
					var reviews = DS.displayReview(value.rating);
					var img = DS.displayImage(value.thumbnail);
					var cat = (value.types.children.length !== 0)? '<p>'+value.types.children[0].name+'</p>': '';

					
					sniffed += '<li class="druid-list-item ui-li-has-thumb item-'+value.type+'">' +
			      	'<a href="single.html?id='+value.id+'" class="ui-btn ui-btn-icon-right ui-icon-carat-r">' + img +'<h2>'+value.title+'</h2>';
					sniffed += reviews;
					sniffed += '<p><strong>'+value.listing.street+', '+value.listing.city+'</strong></p>';
					sniffed += cat;
					sniffed += '</a></li>';
				});
				if(sniffed !== ''){
               		$( ".druid-listings" ).find( "#show-more" ).before(sniffed);
                	$( ".druid-listings" ).listview( "refresh" );
				} else {
				var message = 'We couldn\'t sniff out any listings with the criteria:';
					if (DS.query.search !== '') message += '<p>Keyword: <span style="color:#dd3333">'+DS.query.search+'</span></p>';
					if (DS.address.zip !== '') message += '<p>Zip Code: <span style="color:#dd3333">'+DS.address.zip+'</span></p>';
					if (DS.query.term !== '') message += '<p>Category: <span style="color:#dd3333">'+DS.query.term+'</span></p>';
					$( "#poo h3.ui-title" ).html(message);
					$( "#poo" ).popup( "open" );  
				}
            },
            timeout: 10000,  // Timeout after 10 seconds
            error: function(jqXHR, textStatus, errorThrown) {
                console.log("Error, textStatus: " + textStatus + " errorThrown: "+ errorThrown);              
            }			
        }).done(function() {
			DS.playInputs();
		});
    },
    showRelated: function(whistle) {			
        $.ajax({
			type: 'GET',
			url: whistle,
			dataType: 'json',
            success: function( related ) {
				var sniffed = '';					
        		$.each(related.posts, function(index, value) {
					DS.query.offset += 1;
					console.log(sibling);
					var reviews = DS.displayReview(value.rating);
					var img = DS.displayImage(value.thumbnail);
					var cat = (value.types.children.length !== 0)? '<p>'+value.types.children[0].name+'</p>': '';
					sniffed = sniffed + '<li class="druid-list-item ui-li-has-thumb item-'+value.type+'">' +
			      	'<a href="single.html?id='+value.ID+'" class="ui-btn ui-btn-icon-right ui-icon-carat-r">' + img +'<h2>'+value.title+'</h2>' + reviews +
					'<p><strong>'+value.listing.street+', '+value.listing.city+'</strong></p>' + cat + '</a></li>';
				 });
				if (sniffed !== ''){
                	$( ".druid-related" ).append(sniffed);
               		$( ".druid-related" ).listview( "refresh" );
				} else {
					$( ".contain-related" ).remove();
				}
                DS.playInputs();
            },
            timeout: 10000,  // Timeout after 10 seconds
            error: function(jqXHR, textStatus, errorThrown) {
                console.log("Error, textStatus: " + textStatus + " errorThrown: "+ errorThrown);                
            }
        });
    },
	showReviews: function(reviews) {
     	var sniffed = '';	
		//$( ".druid-reviews" ).append('<li data-role="list-divider">Reviews</li>');
        $.each(reviews, function(index, value) {
			console.log(value);
			var img = value.avatar;
			var name = value.author;
			var review = value.data.comment_content;
			rating = value.rating*100/5;			
			rating = DS.displayReview(rating,true);
			sniffed += '<li class="druid-list-item row-fluid"><div class="span2">' +img+'<em>'+name+'</em></div><div class="span10">'+ rating + review +'</div></li>';
		});
		if (sniffed !== ''){
			$( ".druid-reviews").find( "#submit-review" ).before(sniffed);
			$( ".druid-reviews").listview( "refresh" ); 
		}
    },
	onDeviceReady: function() {
		navigator.geolocation.getCurrentPosition(DS.onSuccess, DS.onError);     
	},
	onSuccess: function(position) {
	var city = DS.address.city;
	var lat = position.coords.latitude;
	var lng = position.coords.longitude;
	var latlng = new google.maps.LatLng(lat, lng);
	DS.geo.lat = lat;
	DS.geo.lng = lng;
	DS.geo.origin = [lat, lng];
	geocoder = new google.maps.Geocoder();
	geocoder.geocode({'latLng': latlng}, function(results, status) {
			console.log(results);
			if (status == google.maps.GeocoderStatus.OK) {		
				DS.address.full = results[0].formatted_address;				
				if (results[1]) {				
					for (var i=0; i<results[0].address_components.length; i++) {
						for (var b=0;b<results[0].address_components[i].types.length;b++) {		
							if (results[0].address_components[i].types[b] == "administrative_area_level_1") {
								city = results[0].address_components[i];															
							if ($.inArray(city.long_name, DS.supported) !== -1){
								DS.address.city = city.long_name;	
								if (DS.address.city == 'Santa Barbara'){
									DS.address.city_code = 'sb';
								} else if (DS.address.city == 'San Francisco') {
									DS.address.city_code = 'sf';
								} else if (DS.address.city == 'Orange County') {
									DS.address.city_code = 'oc';
								}									
							} else {
								break;
							}
							}
							if (results[0].address_components[i].types[b] == "postal_code") {
								//DS.address.zip = results[0].address_components[i].long_name;	
								//DS.nearby = true;
								//$('#opt-zip').val(DS.address.zip);	
								var add = results[0].address_components[0].long_name+' '+results[0].address_components[1].long_name;
								$('#opt-add').val(add);	
								break;
							}
						}
					}				
				} 			
				DS.setSelect('#opt-city',DS.address.city_code);
				DS.showMore();		
			} else {
				alert("Geocoder failed due to: " + status);
			}
		});
	},
	scale: function( width, height, padding, border ){
	 // The window width and height are decreased by 30 to take the tolerance of 15 pixels at each side into account
        var scrWidth = $( window ).width() - 30,
            scrHeight = $( window ).height() - 30,
            ifrPadding = 2 * padding,
            ifrBorder = 2 * border,
            ifrWidth = width + ifrPadding + ifrBorder,
            ifrHeight = height + ifrPadding + ifrBorder,
            h, w;
        if ( ifrWidth < scrWidth && ifrHeight < scrHeight ) {
            w = ifrWidth;
            h = ifrHeight;
        } else if ( ( ifrWidth / scrWidth ) > ( ifrHeight / scrHeight ) ) {
            w = scrWidth;
            h = ( scrWidth / ifrWidth ) * ifrHeight;
        } else {
            h = scrHeight;
            w = ( scrHeight / ifrHeight ) * ifrWidth;
        }
        return {
            'width': w - ( ifrPadding + ifrBorder ),
            'height': h - ( ifrPadding + ifrBorder )
        }
    }	
};
	</script>
    </head>
    <body>
	<div data-role="page" id="home" class="page">
	<div data-role="header" data-position="fixed">
		<h1>Dog Sniffer</h1>
		<a href="#options" data-role="button" data-icon="gear" class="ui-btn-right ui-btn ui-btn-inline ui-mini ui-corner-all ui-btn-icon-right ui-icon-gear">Options</a>
	</div>
	<div role="main" class="ui-content">
	<input type="search" placeholder="Zip Code" id="opt-zip" name="opt-zip" value="" data-clear-btn="true" class="onchange" data-theme="a" />
	<input type="search" placeholder="Sniff For" id="s" name="s" value="" data-clear-btn="true" class="onchange" data-theme="a" />
	<select name="opt-category" id="opt-category" data-native-menu="false"><option data-placeholder="true">Categories</option>
		<option value="all">All Categories</option>
		<option value="activities">Activities</option>
		<option value="dining">Dining</option>
		<option value="health-care">Health & Care</option>
		<option value="services">Services</option>
		<option value="shopping">Shopping</option>
		<option value="training">Training</option>
		<option value="travel">Travel</option>
    </select>
	<ul class="druid-listings ui-corner-all ui-shadow" data-role="listview" data-inset="true">
		<li id="show-more" data-icon="plus" ><a href=""><h1>Show more</h1></a></li>
	</ul>
	</div>
		<div data-role="footer" data-position="fixed" role="contentinfo">			
			<h4 style="display:none;" class="ui-title" role="heading" aria-level="1">Footer</h4>
			<div data-role="navbar">
			<ul><li><a href="#" data-icon="home" class="ui-btn-active ui-btn">Nearby</a></li>
				<li><a href="#register" data-rel="popup" data-icon="user"   data-position-to="window" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-icon-user" data-transition="pop">Sign Up</a></li>
				<li><a href="#login"  data-rel="popup" data-icon="lock"  data-position-to="window" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-icon-lock ui-btn-login" data-transition="pop">Login</a></li>				
			</ul>
			</div>
		</div>
		<div data-role="panel" id="options" data-position="left" data-position-fixed="false" data-display="overlay">
			<h3>Search Options</h3>
			<select name="opt-city" id="opt-city" data-native-menu="false" class="onchange">
				<option>Choose A City</option>
				<option value="la">Los Angeles</option>
				<option value="sb">Santa Barbara</option>
				<option value="oc">Orange County</option>
			</select>	
			<input type="text" placeholder="Street" id="opt-add" name="opt-add" value="" data-clear-btn="true">			
		</div>
		<div data-role="popup" id="login" data-theme="a" class="ui-corner-all">
		<div data-role="header" data-theme="a"><h1>Login</h1></div>
		<form>
		<div style="padding:10px 20px;">
			<div class="alert alert-red login-alert" style="display:none;"></div>
			<div class="user-block">
			<label for="un" class="ui-hidden-accessible">Username:</label>
			<input type="text" placeholder="Username" id="user-field" name="user-field" value="" data-theme="a">
			<label for="pw" class="ui-hidden-accessible">Password:</label>
			<input type="text" placeholder="Password" id="pass-field" name="pass-field" value="" data-theme="a">
			<button type="submit" class="ui-btn ui-corner-all ui-shadow ui-btn-b ui-btn-icon-left ui-icon-check submit-login">Sign in</button>
			</div>			
		</div>
		</form>
		</div>
		<div data-role="popup" id="register" data-theme="a" class="ui-corner-all">
		<div data-role="header" data-theme="a"><h1>Register</h1></div>
		<form>
		<div style="padding:10px 20px;">
			<div class="alert alert-red register-alert" style="display:none;"></div>
			<div class="user-block">
			<label for="user-field" class="ui-hidden-accessible">Username:</label>
			<input type="text" class="reg-field" placeholder="Username" id="user-reg" name="user-reg" value="" data-theme="a">
			<label for="user-email" class="ui-hidden-accessible">E-mail:</label>
			<input type="text" class="reg-field" placeholder="E-mail" id="email-reg" name="email-reg" value="" data-theme="a">
			<label for="pw" class="ui-hidden-accessible">Password:</label>
			<input type="text" class="reg-field" placeholder="Password" id="pass-reg" name="pass-reg" value="" data-theme="a">
			<label for="pw" class="ui-hidden-accessible">Confirm Password:</label>
			<input type="text" class="reg-field" placeholder="Confirm Password" id="pass-confirm" name="pass-confirm" value="" data-theme="a">
			<button type="submit" class="ui-btn ui-corner-all ui-shadow ui-btn-b ui-btn-icon-left ui-icon-check submit-register">Sign Up</button>
			</div>			
		</div>
		</form>
		</div>
		<div data-role="popup" id="error">
			<div role="main" class="ui-content">
				<h3 class="ui-title"></h3>
				<p></p>
			</div>
		</div>
		<div data-role="popup" id="poo">
			 <a href="#" data-rel="back" class="ui-btn ui-btn-b ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right">Close</a>
			<div data-role="header" data-theme="a"><h1>Oh Dog Poo!</h1></div>
			<div role="main" class="ui-content">
				<h3 class="ui-title"></h3>
				<a href="#" id="expand" data-role="button" class="ui-btn ui-corner-all ui-shadow ui-btn-icon-left ui-btn-inline ui-icon-recycle"  data-icon="recycle">Expand Search</a>
				<a href="#" id="research" data-role="button" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-icon-left ui-icon-delete" data-icon="delete">Clear All</a>
			</div>
		</div>
	</div>
    </body>
</html>